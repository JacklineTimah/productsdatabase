"use strict";var _require=require("../queries/user"),addUser=_require.addUser,findUserByEmail=_require.findUserByEmail,_require2=require("../config/database.config"),runQuery=_require2.runQuery,bcrypt=require("bcrypt"),jwt=require("jsonwebtoken"),config=require("../config/env/index"),createUser=function(r){var s,n,a,t,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.username,n=r.email,a=r.password,console.log("Password:",a),e.next=4,regeneratorRuntime.awrap(runQuery(findUserByEmail,[n]));case 4:if(0<e.sent.length)throw{code:409,message:"User already exists",data:null,status:"error"};e.next=7;break;case 7:return 12,console.log("Salt Rounds:",12),t=bcrypt.hashSync(a,12),console.log("Generated Hash:",t),e.next=13,regeneratorRuntime.awrap(runQuery(addUser,[s,n,t]));case 13:return u=e.sent,e.abrupt("return",{code:201,status:"success",message:"New user added successfully",data:u[0]});case 15:case"end":return e.stop()}})},loginUser=function(r){var s,n,a,t,u,o,i,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.email,n=r.password,e.next=3,regeneratorRuntime.awrap(runQuery(findUserByEmail,[s]));case 3:if(0===(a=e.sent).length)throw{code:404,status:"error",message:"User not found",data:null};e.next=6;break;case 6:if(t=a[0],u=t.password,o=t.id,console.log(a[0]),bcrypt.compareSync(n,u)){e.next=11;break}throw{code:400,status:"error",message:"Wrong email and password combination",data:null};case 11:return i={expiresIn:"1d"},c=jwt.sign({id:o,email:s},config.JWT_SECRET_KEY,i),e.abrupt("return",{status:"success",message:"User login successfully",code:200,data:{id:o,email:s,token:c}});case 14:case"end":return e.stop()}})};module.exports={createUser:createUser,loginUser:loginUser};
//# sourceMappingURL=user.service.min.js.map
