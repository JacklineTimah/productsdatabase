{"version":3,"sources":["auth.middleware.js"],"names":["jwt","require","config","runQuery","findUserByEmail","verifyToken","req","res","next","token","user","regeneratorRuntime","async","_context","prev","headers","abrupt","status","json","code","message","data","verify","JWT_SECRET_KEY","t0","stop"],"mappings":"aAAA,IAAMA,IAAMC,QAAQ,gBACdC,OAASD,QAAQ,gCADHA,QAAA,6BAAXE,kBAAAA,mBAGmBF,QAAQ,mBAA5BG,0BAAAA,gBAEFC,YAAc,SAAOC,EAAKC,EAAKC,GAAjB,IAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAL,MAAA,KAAA,EAAA,GACVC,EAJWR,EAAOc,QAAPd,cAGDY,EAAAC,KAAA,EAGPL,EAHO,CAAAI,EAAAL,KAAA,EAAA,MAAA,OAAAK,EAAAG,OAAA,SAFQf,EAAOgB,OAAC,KAAAC,KAAA,CAA5Bd,OAOgB,QACRe,KAAM,IANLC,QAAG,sBAAAC,KAAA,QAAA,KAAA,EAAA,GAAAX,EAAAV,IAAAsB,OAAAb,EAAAP,OAAAqB,gBAAA,CAAAV,EAAAL,KAAA,EAAA,MAAA,OAAAK,EAAAG,OAAA,SAAAT,EAAAU,OAAA,KAAAC,KAAA,CAeND,OAAQ,QAZTR,KAHO,IAAAW,QAAA,+CAAAC,KAAA,QAAA,KAAA,EAAA,OAAAf,EAAAI,KAAAA,EAAAG,EAAAG,OAAA,SAKJC,KALI,KAAA,GAAA,OAAAJ,EAAAC,KAAA,GAAAD,EAAAW,GAAAX,EAAA,MAAA,GAAAA,EAAAG,OAAA,SAOJI,EAASP,EAAAW,KAPL,KAAA,GAAA,IAAA,MAAA,OAAAX,EAAAY,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OAYNf,OAAAA,QAAOV,CAkBjBK,YAAAA","file":"auth.middleware.min.js","sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst config = require('../config/env/index');\r\nconst { runQuery } = require('../config/database.config')\r\nconst { findUserByEmail } = require('../queries/user');\r\n\r\nconst verifyToken = async (req, res, next) => {\r\n    const token = req.headers['authorization'];\r\n    try {\r\n        if (!token) {\r\n            return res.status(400).json({\r\n                status: 'error',\r\n                code: 400,\r\n                message: 'Please supply token',\r\n                data: null\r\n            });\r\n        }\r\n\r\n        const user = jwt.verify(token, config.JWT_SECRET_KEY);\r\n        if (!user) {\r\n            return res.status(400).json({\r\n              status: 'error',\r\n              code: 401,\r\n              message: 'You are not authorized to make this request!',\r\n              data: null,\r\n            });\r\n          }\r\n          req.user = user;\r\n          return next();\r\n        } catch (error) {\r\n          return next(error);\r\n        }\r\n      };\r\n      \r\n\r\nmodule.exports =  {\r\n    verifyToken\r\n}"]}